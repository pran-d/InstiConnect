"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactJsonTree = _interopRequireDefault(require("react-json-tree"));

var _LogMonitorEntryAction = _interopRequireDefault(require("./LogMonitorEntryAction"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }

function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

var styles = {
  entry: {
    display: 'block',
    WebkitUserSelect: 'none'
  },
  root: {
    marginLeft: 0
  }
};

var getDeepItem = function getDeepItem(data, path) {
  return path.reduce(function (obj, key) {
    return obj && obj[key];
  }, data);
};

var dataIsEqual = function dataIsEqual(data, previousData, keyPath) {
  var path = _toConsumableArray(keyPath).reverse().slice(1);

  return getDeepItem(data, path) === getDeepItem(previousData, path);
};

var LogMonitorEntry = /*#__PURE__*/function (_PureComponent) {
  _inherits(LogMonitorEntry, _PureComponent);

  var _super = _createSuper(LogMonitorEntry);

  function LogMonitorEntry() {
    var _this;

    _classCallCheck(this, LogMonitorEntry);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));

    _defineProperty(_assertThisInitialized(_this), "handleActionClick", function (e) {
      var _this$props = _this.props,
          actionId = _this$props.actionId,
          onActionClick = _this$props.onActionClick,
          onActionShiftClick = _this$props.onActionShiftClick;

      if (actionId > 0) {
        if (e.shiftKey) {
          onActionShiftClick(actionId);
        } else {
          onActionClick(actionId);
        }
      }
    });

    _defineProperty(_assertThisInitialized(_this), "shouldExpandNode", function (keyPath, data, level) {
      return _this.props.expandStateRoot && level === 0;
    });

    return _this;
  }

  _createClass(LogMonitorEntry, [{
    key: "printState",
    value: function printState(state, error) {
      var _this2 = this;

      var errorText = error;

      if (!errorText) {
        try {
          var data = this.props.select(state);
          var theme;

          if (this.props.markStateDiff) {
            var previousData = typeof this.props.previousState !== 'undefined' ? this.props.select(this.props.previousState) : undefined;

            var getValueStyle = function getValueStyle(_ref, nodeType, keyPath) {
              var style = _ref.style;
              return {
                style: _objectSpread(_objectSpread({}, style), {}, {
                  backgroundColor: dataIsEqual(data, previousData, keyPath) ? 'transparent' : _this2.props.theme.base01
                })
              };
            };

            var getNestedNodeStyle = function getNestedNodeStyle(_ref2, keyPath) {
              var style = _ref2.style;
              return {
                style: _objectSpread(_objectSpread({}, style), keyPath.length > 1 ? {} : styles.root)
              };
            };

            theme = {
              extend: this.props.theme,
              value: getValueStyle,
              nestedNode: getNestedNodeStyle
            };
          } else {
            theme = this.props.theme;
          }

          return /*#__PURE__*/_react["default"].createElement(_reactJsonTree["default"], {
            theme: theme,
            data: data,
            invertTheme: false,
            keyPath: ['state'],
            shouldExpandNode: this.shouldExpandNode
          });
        } catch (err) {
          errorText = 'Error selecting state.';
        }
      }

      return /*#__PURE__*/_react["default"].createElement("div", {
        style: {
          color: this.props.theme.base08,
          paddingTop: 20,
          paddingLeft: 30,
          paddingRight: 30,
          paddingBottom: 35
        }
      }, errorText);
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props2 = this.props,
          actionId = _this$props2.actionId,
          error = _this$props2.error,
          action = _this$props2.action,
          state = _this$props2.state,
          collapsed = _this$props2.collapsed,
          selected = _this$props2.selected,
          inFuture = _this$props2.inFuture;
      var styleEntry = {
        opacity: collapsed ? 0.5 : 1,
        cursor: actionId > 0 ? 'pointer' : 'default'
      };
      return /*#__PURE__*/_react["default"].createElement("div", {
        style: {
          opacity: selected ? 0.4 : inFuture ? 0.6 : 1,
          // eslint-disable-line no-nested-ternary
          textDecoration: collapsed ? 'line-through' : 'none',
          color: this.props.theme.base06
        }
      }, /*#__PURE__*/_react["default"].createElement(_LogMonitorEntryAction["default"], {
        theme: this.props.theme,
        collapsed: collapsed,
        action: action,
        expandActionRoot: this.props.expandActionRoot,
        onClick: this.handleActionClick,
        style: _objectSpread(_objectSpread({}, styles.entry), styleEntry)
      }), !collapsed && /*#__PURE__*/_react["default"].createElement("div", {
        style: {
          paddingLeft: 16
        }
      }, this.printState(state, error)));
    }
  }]);

  return LogMonitorEntry;
}(_react.PureComponent);

exports["default"] = LogMonitorEntry;

_defineProperty(LogMonitorEntry, "propTypes", {
  state: _propTypes["default"].object.isRequired,
  action: _propTypes["default"].object.isRequired,
  actionId: _propTypes["default"].number.isRequired,
  select: _propTypes["default"].func.isRequired,
  inFuture: _propTypes["default"].bool,
  error: _propTypes["default"].string,
  onActionClick: _propTypes["default"].func.isRequired,
  onActionShiftClick: _propTypes["default"].func.isRequired,
  collapsed: _propTypes["default"].bool,
  selected: _propTypes["default"].bool,
  expandActionRoot: _propTypes["default"].bool,
  expandStateRoot: _propTypes["default"].bool,
  previousState: _propTypes["default"].object
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Mb2dNb25pdG9yRW50cnkudHN4Il0sIm5hbWVzIjpbInN0eWxlcyIsImVudHJ5IiwiZGlzcGxheSIsIldlYmtpdFVzZXJTZWxlY3QiLCJyb290IiwibWFyZ2luTGVmdCIsImdldERlZXBJdGVtIiwiZGF0YSIsInBhdGgiLCJyZWR1Y2UiLCJvYmoiLCJrZXkiLCJkYXRhSXNFcXVhbCIsInByZXZpb3VzRGF0YSIsImtleVBhdGgiLCJyZXZlcnNlIiwic2xpY2UiLCJMb2dNb25pdG9yRW50cnkiLCJlIiwicHJvcHMiLCJhY3Rpb25JZCIsIm9uQWN0aW9uQ2xpY2siLCJvbkFjdGlvblNoaWZ0Q2xpY2siLCJzaGlmdEtleSIsImxldmVsIiwiZXhwYW5kU3RhdGVSb290Iiwic3RhdGUiLCJlcnJvciIsImVycm9yVGV4dCIsInNlbGVjdCIsInRoZW1lIiwibWFya1N0YXRlRGlmZiIsInByZXZpb3VzU3RhdGUiLCJ1bmRlZmluZWQiLCJnZXRWYWx1ZVN0eWxlIiwibm9kZVR5cGUiLCJzdHlsZSIsImJhY2tncm91bmRDb2xvciIsImJhc2UwMSIsImdldE5lc3RlZE5vZGVTdHlsZSIsImxlbmd0aCIsImV4dGVuZCIsInZhbHVlIiwibmVzdGVkTm9kZSIsInNob3VsZEV4cGFuZE5vZGUiLCJlcnIiLCJjb2xvciIsImJhc2UwOCIsInBhZGRpbmdUb3AiLCJwYWRkaW5nTGVmdCIsInBhZGRpbmdSaWdodCIsInBhZGRpbmdCb3R0b20iLCJhY3Rpb24iLCJjb2xsYXBzZWQiLCJzZWxlY3RlZCIsImluRnV0dXJlIiwic3R5bGVFbnRyeSIsIm9wYWNpdHkiLCJjdXJzb3IiLCJ0ZXh0RGVjb3JhdGlvbiIsImJhc2UwNiIsImV4cGFuZEFjdGlvblJvb3QiLCJoYW5kbGVBY3Rpb25DbGljayIsInByaW50U3RhdGUiLCJQdXJlQ29tcG9uZW50IiwiUHJvcFR5cGVzIiwib2JqZWN0IiwiaXNSZXF1aXJlZCIsIm51bWJlciIsImZ1bmMiLCJib29sIiwic3RyaW5nIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFHQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLE1BQXFELEdBQUc7QUFDNURDLEVBQUFBLEtBQUssRUFBRTtBQUNMQyxJQUFBQSxPQUFPLEVBQUUsT0FESjtBQUVMQyxJQUFBQSxnQkFBZ0IsRUFBRTtBQUZiLEdBRHFEO0FBTTVEQyxFQUFBQSxJQUFJLEVBQUU7QUFDSkMsSUFBQUEsVUFBVSxFQUFFO0FBRFI7QUFOc0QsQ0FBOUQ7O0FBV0EsSUFBTUMsV0FBVyxHQUFHLFNBQWRBLFdBQWMsQ0FBQ0MsSUFBRCxFQUFZQyxJQUFaO0FBQUEsU0FDbEJBLElBQUksQ0FBQ0MsTUFBTCxDQUFZLFVBQUNDLEdBQUQsRUFBTUMsR0FBTjtBQUFBLFdBQWNELEdBQUcsSUFBSUEsR0FBRyxDQUFDQyxHQUFELENBQXhCO0FBQUEsR0FBWixFQUEyQ0osSUFBM0MsQ0FEa0I7QUFBQSxDQUFwQjs7QUFFQSxJQUFNSyxXQUFXLEdBQUcsU0FBZEEsV0FBYyxDQUNsQkwsSUFEa0IsRUFFbEJNLFlBRmtCLEVBR2xCQyxPQUhrQixFQUlmO0FBQ0gsTUFBTU4sSUFBSSxHQUFHLG1CQUFJTSxPQUFKLEVBQWFDLE9BQWIsR0FBdUJDLEtBQXZCLENBQTZCLENBQTdCLENBQWI7O0FBRUEsU0FBT1YsV0FBVyxDQUFDQyxJQUFELEVBQU9DLElBQVAsQ0FBWCxLQUE0QkYsV0FBVyxDQUFDTyxZQUFELEVBQWVMLElBQWYsQ0FBOUM7QUFDRCxDQVJEOztJQTRCcUJTLGU7Ozs7Ozs7Ozs7Ozs7Ozs7d0VBNEZvQyxVQUFDQyxDQUFELEVBQU87QUFDNUQsd0JBQXdELE1BQUtDLEtBQTdEO0FBQUEsVUFBUUMsUUFBUixlQUFRQSxRQUFSO0FBQUEsVUFBa0JDLGFBQWxCLGVBQWtCQSxhQUFsQjtBQUFBLFVBQWlDQyxrQkFBakMsZUFBaUNBLGtCQUFqQzs7QUFDQSxVQUFJRixRQUFRLEdBQUcsQ0FBZixFQUFrQjtBQUNoQixZQUFJRixDQUFDLENBQUNLLFFBQU4sRUFBZ0I7QUFDZEQsVUFBQUEsa0JBQWtCLENBQUNGLFFBQUQsQ0FBbEI7QUFDRCxTQUZELE1BRU87QUFDTEMsVUFBQUEsYUFBYSxDQUFDRCxRQUFELENBQWI7QUFDRDtBQUNGO0FBQ0YsSzs7dUVBRWtCLFVBQ2pCTixPQURpQixFQUVqQlAsSUFGaUIsRUFHakJpQixLQUhpQixFQUlkO0FBQ0gsYUFBTyxNQUFLTCxLQUFMLENBQVdNLGVBQVgsSUFBOEJELEtBQUssS0FBSyxDQUEvQztBQUNELEs7Ozs7Ozs7V0F6RkQsb0JBQVdFLEtBQVgsRUFBcUJDLEtBQXJCLEVBQWdEO0FBQUE7O0FBQzlDLFVBQUlDLFNBQVMsR0FBR0QsS0FBaEI7O0FBQ0EsVUFBSSxDQUFDQyxTQUFMLEVBQWdCO0FBQ2QsWUFBSTtBQUNGLGNBQU1yQixJQUFJLEdBQUcsS0FBS1ksS0FBTCxDQUFXVSxNQUFYLENBQWtCSCxLQUFsQixDQUFiO0FBQ0EsY0FBSUksS0FBSjs7QUFFQSxjQUFJLEtBQUtYLEtBQUwsQ0FBV1ksYUFBZixFQUE4QjtBQUM1QixnQkFBTWxCLFlBQVksR0FDaEIsT0FBTyxLQUFLTSxLQUFMLENBQVdhLGFBQWxCLEtBQW9DLFdBQXBDLEdBQ0ksS0FBS2IsS0FBTCxDQUFXVSxNQUFYLENBQWtCLEtBQUtWLEtBQUwsQ0FBV2EsYUFBN0IsQ0FESixHQUVJQyxTQUhOOztBQUlBLGdCQUFNQyxhQUEyQixHQUFHLFNBQTlCQSxhQUE4QixPQUVsQ0MsUUFGa0MsRUFHbENyQixPQUhrQztBQUFBLGtCQUNoQ3NCLEtBRGdDLFFBQ2hDQSxLQURnQztBQUFBLHFCQUk5QjtBQUNKQSxnQkFBQUEsS0FBSyxrQ0FDQUEsS0FEQTtBQUVIQyxrQkFBQUEsZUFBZSxFQUFFekIsV0FBVyxDQUMxQkwsSUFEMEIsRUFFMUJNLFlBRjBCLEVBRzFCQyxPQUgwQixDQUFYLEdBS2IsYUFMYSxHQU1iLE1BQUksQ0FBQ0ssS0FBTCxDQUFXVyxLQUFYLENBQWlCUTtBQVJsQjtBQURELGVBSjhCO0FBQUEsYUFBcEM7O0FBZ0JBLGdCQUFNQyxrQkFBZ0MsR0FBRyxTQUFuQ0Esa0JBQW1DLFFBQVl6QixPQUFaO0FBQUEsa0JBQUdzQixLQUFILFNBQUdBLEtBQUg7QUFBQSxxQkFBeUI7QUFDaEVBLGdCQUFBQSxLQUFLLGtDQUNBQSxLQURBLEdBRUV0QixPQUFELENBQXVCMEIsTUFBdkIsR0FBZ0MsQ0FBaEMsR0FBb0MsRUFBcEMsR0FBeUN4QyxNQUFNLENBQUNJLElBRmpEO0FBRDJELGVBQXpCO0FBQUEsYUFBekM7O0FBTUEwQixZQUFBQSxLQUFLLEdBQUc7QUFDTlcsY0FBQUEsTUFBTSxFQUFFLEtBQUt0QixLQUFMLENBQVdXLEtBRGI7QUFFTlksY0FBQUEsS0FBSyxFQUFFUixhQUZEO0FBR05TLGNBQUFBLFVBQVUsRUFBRUo7QUFITixhQUFSO0FBS0QsV0FoQ0QsTUFnQ087QUFDTFQsWUFBQUEsS0FBSyxHQUFHLEtBQUtYLEtBQUwsQ0FBV1csS0FBbkI7QUFDRDs7QUFFRCw4QkFDRSxnQ0FBQyx5QkFBRDtBQUNFLFlBQUEsS0FBSyxFQUFFQSxLQURUO0FBRUUsWUFBQSxJQUFJLEVBQUV2QixJQUZSO0FBR0UsWUFBQSxXQUFXLEVBQUUsS0FIZjtBQUlFLFlBQUEsT0FBTyxFQUFFLENBQUMsT0FBRCxDQUpYO0FBS0UsWUFBQSxnQkFBZ0IsRUFBRSxLQUFLcUM7QUFMekIsWUFERjtBQVNELFNBakRELENBaURFLE9BQU9DLEdBQVAsRUFBWTtBQUNaakIsVUFBQUEsU0FBUyxHQUFHLHdCQUFaO0FBQ0Q7QUFDRjs7QUFFRCwwQkFDRTtBQUNFLFFBQUEsS0FBSyxFQUFFO0FBQ0xrQixVQUFBQSxLQUFLLEVBQUUsS0FBSzNCLEtBQUwsQ0FBV1csS0FBWCxDQUFpQmlCLE1BRG5CO0FBRUxDLFVBQUFBLFVBQVUsRUFBRSxFQUZQO0FBR0xDLFVBQUFBLFdBQVcsRUFBRSxFQUhSO0FBSUxDLFVBQUFBLFlBQVksRUFBRSxFQUpUO0FBS0xDLFVBQUFBLGFBQWEsRUFBRTtBQUxWO0FBRFQsU0FTR3ZCLFNBVEgsQ0FERjtBQWFEOzs7V0FxQkQsa0JBQVM7QUFDUCx5QkFDRSxLQUFLVCxLQURQO0FBQUEsVUFBUUMsUUFBUixnQkFBUUEsUUFBUjtBQUFBLFVBQWtCTyxLQUFsQixnQkFBa0JBLEtBQWxCO0FBQUEsVUFBeUJ5QixNQUF6QixnQkFBeUJBLE1BQXpCO0FBQUEsVUFBaUMxQixLQUFqQyxnQkFBaUNBLEtBQWpDO0FBQUEsVUFBd0MyQixTQUF4QyxnQkFBd0NBLFNBQXhDO0FBQUEsVUFBbURDLFFBQW5ELGdCQUFtREEsUUFBbkQ7QUFBQSxVQUE2REMsUUFBN0QsZ0JBQTZEQSxRQUE3RDtBQUVBLFVBQU1DLFVBQVUsR0FBRztBQUNqQkMsUUFBQUEsT0FBTyxFQUFFSixTQUFTLEdBQUcsR0FBSCxHQUFTLENBRFY7QUFFakJLLFFBQUFBLE1BQU0sRUFBRXRDLFFBQVEsR0FBRyxDQUFYLEdBQWUsU0FBZixHQUEyQjtBQUZsQixPQUFuQjtBQUtBLDBCQUNFO0FBQ0UsUUFBQSxLQUFLLEVBQUU7QUFDTHFDLFVBQUFBLE9BQU8sRUFBRUgsUUFBUSxHQUFHLEdBQUgsR0FBU0MsUUFBUSxHQUFHLEdBQUgsR0FBUyxDQUR0QztBQUN5QztBQUM5Q0ksVUFBQUEsY0FBYyxFQUFFTixTQUFTLEdBQUcsY0FBSCxHQUFvQixNQUZ4QztBQUdMUCxVQUFBQSxLQUFLLEVBQUUsS0FBSzNCLEtBQUwsQ0FBV1csS0FBWCxDQUFpQjhCO0FBSG5CO0FBRFQsc0JBT0UsZ0NBQUMsaUNBQUQ7QUFDRSxRQUFBLEtBQUssRUFBRSxLQUFLekMsS0FBTCxDQUFXVyxLQURwQjtBQUVFLFFBQUEsU0FBUyxFQUFFdUIsU0FGYjtBQUdFLFFBQUEsTUFBTSxFQUFFRCxNQUhWO0FBSUUsUUFBQSxnQkFBZ0IsRUFBRSxLQUFLakMsS0FBTCxDQUFXMEMsZ0JBSi9CO0FBS0UsUUFBQSxPQUFPLEVBQUUsS0FBS0MsaUJBTGhCO0FBTUUsUUFBQSxLQUFLLGtDQUFPOUQsTUFBTSxDQUFDQyxLQUFkLEdBQXdCdUQsVUFBeEI7QUFOUCxRQVBGLEVBZUcsQ0FBQ0gsU0FBRCxpQkFDQztBQUFLLFFBQUEsS0FBSyxFQUFFO0FBQUVKLFVBQUFBLFdBQVcsRUFBRTtBQUFmO0FBQVosU0FBa0MsS0FBS2MsVUFBTCxDQUFnQnJDLEtBQWhCLEVBQXVCQyxLQUF2QixDQUFsQyxDQWhCSixDQURGO0FBcUJEOzs7O0VBeklPcUMsb0I7Ozs7Z0JBSFcvQyxlLGVBSUE7QUFDakJTLEVBQUFBLEtBQUssRUFBRXVDLHNCQUFVQyxNQUFWLENBQWlCQyxVQURQO0FBRWpCZixFQUFBQSxNQUFNLEVBQUVhLHNCQUFVQyxNQUFWLENBQWlCQyxVQUZSO0FBR2pCL0MsRUFBQUEsUUFBUSxFQUFFNkMsc0JBQVVHLE1BQVYsQ0FBaUJELFVBSFY7QUFJakJ0QyxFQUFBQSxNQUFNLEVBQUVvQyxzQkFBVUksSUFBVixDQUFlRixVQUpOO0FBS2pCWixFQUFBQSxRQUFRLEVBQUVVLHNCQUFVSyxJQUxIO0FBTWpCM0MsRUFBQUEsS0FBSyxFQUFFc0Msc0JBQVVNLE1BTkE7QUFPakJsRCxFQUFBQSxhQUFhLEVBQUU0QyxzQkFBVUksSUFBVixDQUFlRixVQVBiO0FBUWpCN0MsRUFBQUEsa0JBQWtCLEVBQUUyQyxzQkFBVUksSUFBVixDQUFlRixVQVJsQjtBQVNqQmQsRUFBQUEsU0FBUyxFQUFFWSxzQkFBVUssSUFUSjtBQVVqQmhCLEVBQUFBLFFBQVEsRUFBRVcsc0JBQVVLLElBVkg7QUFXakJULEVBQUFBLGdCQUFnQixFQUFFSSxzQkFBVUssSUFYWDtBQVlqQjdDLEVBQUFBLGVBQWUsRUFBRXdDLHNCQUFVSyxJQVpWO0FBYWpCdEMsRUFBQUEsYUFBYSxFQUFFaUMsc0JBQVVDO0FBYlIsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDU1NQcm9wZXJ0aWVzLCBNb3VzZUV2ZW50SGFuZGxlciwgUHVyZUNvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgSlNPTlRyZWUsIHsgU3R5bGluZ1ZhbHVlIH0gZnJvbSAncmVhY3QtanNvbi10cmVlJztcbmltcG9ydCB7IEJhc2UxNlRoZW1lIH0gZnJvbSAncmVkdXgtZGV2dG9vbHMtdGhlbWVzJztcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gJ3JlZHV4JztcbmltcG9ydCBMb2dNb25pdG9yRW50cnlBY3Rpb24gZnJvbSAnLi9Mb2dNb25pdG9yRW50cnlBY3Rpb24nO1xuXG5jb25zdCBzdHlsZXM6IHsgZW50cnk6IENTU1Byb3BlcnRpZXM7IHJvb3Q6IENTU1Byb3BlcnRpZXMgfSA9IHtcbiAgZW50cnk6IHtcbiAgICBkaXNwbGF5OiAnYmxvY2snLFxuICAgIFdlYmtpdFVzZXJTZWxlY3Q6ICdub25lJyxcbiAgfSxcblxuICByb290OiB7XG4gICAgbWFyZ2luTGVmdDogMCxcbiAgfSxcbn07XG5cbmNvbnN0IGdldERlZXBJdGVtID0gKGRhdGE6IGFueSwgcGF0aDogKHN0cmluZyB8IG51bWJlcilbXSkgPT5cbiAgcGF0aC5yZWR1Y2UoKG9iaiwga2V5KSA9PiBvYmogJiYgb2JqW2tleV0sIGRhdGEpO1xuY29uc3QgZGF0YUlzRXF1YWwgPSAoXG4gIGRhdGE6IGFueSxcbiAgcHJldmlvdXNEYXRhOiB1bmtub3duLFxuICBrZXlQYXRoOiAoc3RyaW5nIHwgbnVtYmVyKVtdXG4pID0+IHtcbiAgY29uc3QgcGF0aCA9IFsuLi5rZXlQYXRoXS5yZXZlcnNlKCkuc2xpY2UoMSk7XG5cbiAgcmV0dXJuIGdldERlZXBJdGVtKGRhdGEsIHBhdGgpID09PSBnZXREZWVwSXRlbShwcmV2aW91c0RhdGEsIHBhdGgpO1xufTtcblxuaW50ZXJmYWNlIFByb3BzPFMsIEEgZXh0ZW5kcyBBY3Rpb248dW5rbm93bj4+IHtcbiAgdGhlbWU6IEJhc2UxNlRoZW1lO1xuICBzZWxlY3Q6IChzdGF0ZTogYW55KSA9PiB1bmtub3duO1xuICBhY3Rpb246IEE7XG4gIGFjdGlvbklkOiBudW1iZXI7XG4gIHN0YXRlOiBTO1xuICBwcmV2aW91c1N0YXRlOiBTIHwgdW5kZWZpbmVkO1xuICBjb2xsYXBzZWQ6IGJvb2xlYW47XG4gIGluRnV0dXJlOiBib29sZWFuO1xuICBzZWxlY3RlZDogYm9vbGVhbjtcbiAgZXJyb3I6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgZXhwYW5kQWN0aW9uUm9vdDogYm9vbGVhbjtcbiAgZXhwYW5kU3RhdGVSb290OiBib29sZWFuO1xuICBtYXJrU3RhdGVEaWZmOiBib29sZWFuO1xuICBvbkFjdGlvbkNsaWNrOiAoaWQ6IG51bWJlcikgPT4gdm9pZDtcbiAgb25BY3Rpb25TaGlmdENsaWNrOiAoaWQ6IG51bWJlcikgPT4gdm9pZDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9nTW9uaXRvckVudHJ5PFxuICBTLFxuICBBIGV4dGVuZHMgQWN0aW9uPHVua25vd24+XG4+IGV4dGVuZHMgUHVyZUNvbXBvbmVudDxQcm9wczxTLCBBPj4ge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIHN0YXRlOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgYWN0aW9uOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgYWN0aW9uSWQ6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgICBzZWxlY3Q6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgaW5GdXR1cmU6IFByb3BUeXBlcy5ib29sLFxuICAgIGVycm9yOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIG9uQWN0aW9uQ2xpY2s6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25BY3Rpb25TaGlmdENsaWNrOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGNvbGxhcHNlZDogUHJvcFR5cGVzLmJvb2wsXG4gICAgc2VsZWN0ZWQ6IFByb3BUeXBlcy5ib29sLFxuICAgIGV4cGFuZEFjdGlvblJvb3Q6IFByb3BUeXBlcy5ib29sLFxuICAgIGV4cGFuZFN0YXRlUm9vdDogUHJvcFR5cGVzLmJvb2wsXG4gICAgcHJldmlvdXNTdGF0ZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgfTtcblxuICBwcmludFN0YXRlKHN0YXRlOiBTLCBlcnJvcjogc3RyaW5nIHwgdW5kZWZpbmVkKSB7XG4gICAgbGV0IGVycm9yVGV4dCA9IGVycm9yO1xuICAgIGlmICghZXJyb3JUZXh0KSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5wcm9wcy5zZWxlY3Qoc3RhdGUpO1xuICAgICAgICBsZXQgdGhlbWU7XG5cbiAgICAgICAgaWYgKHRoaXMucHJvcHMubWFya1N0YXRlRGlmZikge1xuICAgICAgICAgIGNvbnN0IHByZXZpb3VzRGF0YSA9XG4gICAgICAgICAgICB0eXBlb2YgdGhpcy5wcm9wcy5wcmV2aW91c1N0YXRlICE9PSAndW5kZWZpbmVkJ1xuICAgICAgICAgICAgICA/IHRoaXMucHJvcHMuc2VsZWN0KHRoaXMucHJvcHMucHJldmlvdXNTdGF0ZSlcbiAgICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgY29uc3QgZ2V0VmFsdWVTdHlsZTogU3R5bGluZ1ZhbHVlID0gKFxuICAgICAgICAgICAgeyBzdHlsZSB9LFxuICAgICAgICAgICAgbm9kZVR5cGUsXG4gICAgICAgICAgICBrZXlQYXRoXG4gICAgICAgICAgKSA9PiAoe1xuICAgICAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAgICAgLi4uc3R5bGUsXG4gICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogZGF0YUlzRXF1YWwoXG4gICAgICAgICAgICAgICAgZGF0YSxcbiAgICAgICAgICAgICAgICBwcmV2aW91c0RhdGEsXG4gICAgICAgICAgICAgICAga2V5UGF0aCBhcyAoc3RyaW5nIHwgbnVtYmVyKVtdXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICA/ICd0cmFuc3BhcmVudCdcbiAgICAgICAgICAgICAgICA6IHRoaXMucHJvcHMudGhlbWUuYmFzZTAxLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCBnZXROZXN0ZWROb2RlU3R5bGU6IFN0eWxpbmdWYWx1ZSA9ICh7IHN0eWxlIH0sIGtleVBhdGgpID0+ICh7XG4gICAgICAgICAgICBzdHlsZToge1xuICAgICAgICAgICAgICAuLi5zdHlsZSxcbiAgICAgICAgICAgICAgLi4uKChrZXlQYXRoIGFzIHVua25vd25bXSkubGVuZ3RoID4gMSA/IHt9IDogc3R5bGVzLnJvb3QpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB0aGVtZSA9IHtcbiAgICAgICAgICAgIGV4dGVuZDogdGhpcy5wcm9wcy50aGVtZSxcbiAgICAgICAgICAgIHZhbHVlOiBnZXRWYWx1ZVN0eWxlLFxuICAgICAgICAgICAgbmVzdGVkTm9kZTogZ2V0TmVzdGVkTm9kZVN0eWxlLFxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhlbWUgPSB0aGlzLnByb3BzLnRoZW1lO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICA8SlNPTlRyZWVcbiAgICAgICAgICAgIHRoZW1lPXt0aGVtZX1cbiAgICAgICAgICAgIGRhdGE9e2RhdGF9XG4gICAgICAgICAgICBpbnZlcnRUaGVtZT17ZmFsc2V9XG4gICAgICAgICAgICBrZXlQYXRoPXtbJ3N0YXRlJ119XG4gICAgICAgICAgICBzaG91bGRFeHBhbmROb2RlPXt0aGlzLnNob3VsZEV4cGFuZE5vZGV9XG4gICAgICAgICAgLz5cbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBlcnJvclRleHQgPSAnRXJyb3Igc2VsZWN0aW5nIHN0YXRlLic7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXZcbiAgICAgICAgc3R5bGU9e3tcbiAgICAgICAgICBjb2xvcjogdGhpcy5wcm9wcy50aGVtZS5iYXNlMDgsXG4gICAgICAgICAgcGFkZGluZ1RvcDogMjAsXG4gICAgICAgICAgcGFkZGluZ0xlZnQ6IDMwLFxuICAgICAgICAgIHBhZGRpbmdSaWdodDogMzAsXG4gICAgICAgICAgcGFkZGluZ0JvdHRvbTogMzUsXG4gICAgICAgIH19XG4gICAgICA+XG4gICAgICAgIHtlcnJvclRleHR9XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgaGFuZGxlQWN0aW9uQ2xpY2s6IE1vdXNlRXZlbnRIYW5kbGVyPEhUTUxEaXZFbGVtZW50PiA9IChlKSA9PiB7XG4gICAgY29uc3QgeyBhY3Rpb25JZCwgb25BY3Rpb25DbGljaywgb25BY3Rpb25TaGlmdENsaWNrIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChhY3Rpb25JZCA+IDApIHtcbiAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgIG9uQWN0aW9uU2hpZnRDbGljayhhY3Rpb25JZCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvbkFjdGlvbkNsaWNrKGFjdGlvbklkKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgc2hvdWxkRXhwYW5kTm9kZSA9IChcbiAgICBrZXlQYXRoOiAoc3RyaW5nIHwgbnVtYmVyKVtdLFxuICAgIGRhdGE6IGFueSxcbiAgICBsZXZlbDogbnVtYmVyXG4gICkgPT4ge1xuICAgIHJldHVybiB0aGlzLnByb3BzLmV4cGFuZFN0YXRlUm9vdCAmJiBsZXZlbCA9PT0gMDtcbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBhY3Rpb25JZCwgZXJyb3IsIGFjdGlvbiwgc3RhdGUsIGNvbGxhcHNlZCwgc2VsZWN0ZWQsIGluRnV0dXJlIH0gPVxuICAgICAgdGhpcy5wcm9wcztcbiAgICBjb25zdCBzdHlsZUVudHJ5ID0ge1xuICAgICAgb3BhY2l0eTogY29sbGFwc2VkID8gMC41IDogMSxcbiAgICAgIGN1cnNvcjogYWN0aW9uSWQgPiAwID8gJ3BvaW50ZXInIDogJ2RlZmF1bHQnLFxuICAgIH07XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICBzdHlsZT17e1xuICAgICAgICAgIG9wYWNpdHk6IHNlbGVjdGVkID8gMC40IDogaW5GdXR1cmUgPyAwLjYgOiAxLCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5lc3RlZC10ZXJuYXJ5XG4gICAgICAgICAgdGV4dERlY29yYXRpb246IGNvbGxhcHNlZCA/ICdsaW5lLXRocm91Z2gnIDogJ25vbmUnLFxuICAgICAgICAgIGNvbG9yOiB0aGlzLnByb3BzLnRoZW1lLmJhc2UwNixcbiAgICAgICAgfX1cbiAgICAgID5cbiAgICAgICAgPExvZ01vbml0b3JFbnRyeUFjdGlvblxuICAgICAgICAgIHRoZW1lPXt0aGlzLnByb3BzLnRoZW1lfVxuICAgICAgICAgIGNvbGxhcHNlZD17Y29sbGFwc2VkfVxuICAgICAgICAgIGFjdGlvbj17YWN0aW9ufVxuICAgICAgICAgIGV4cGFuZEFjdGlvblJvb3Q9e3RoaXMucHJvcHMuZXhwYW5kQWN0aW9uUm9vdH1cbiAgICAgICAgICBvbkNsaWNrPXt0aGlzLmhhbmRsZUFjdGlvbkNsaWNrfVxuICAgICAgICAgIHN0eWxlPXt7IC4uLnN0eWxlcy5lbnRyeSwgLi4uc3R5bGVFbnRyeSB9fVxuICAgICAgICAvPlxuICAgICAgICB7IWNvbGxhcHNlZCAmJiAoXG4gICAgICAgICAgPGRpdiBzdHlsZT17eyBwYWRkaW5nTGVmdDogMTYgfX0+e3RoaXMucHJpbnRTdGF0ZShzdGF0ZSwgZXJyb3IpfTwvZGl2PlxuICAgICAgICApfVxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuIl19